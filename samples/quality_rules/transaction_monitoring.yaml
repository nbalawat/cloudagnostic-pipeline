---
# Transaction Monitoring Quality Rules
name: "Transaction Data Quality Suite"
description: "Comprehensive data quality rules for banking transaction monitoring"
domain: "banking"
category: "transaction_monitoring"
version: "1.0.0"

rules:
  - id: "tx_amount_range"
    name: "Transaction Amount Range Check"
    description: "Validates transaction amounts are within acceptable ranges"
    type: "range_check"
    severity: "critical"
    config:
      column: "transaction_amount"
      min_value: 0.01
      max_value: 1000000.00
      currency: "USD"
      action_on_violation: "flag"
    metadata:
      regulatory_requirement: "BSA/AML"
      business_unit: "Retail Banking"

  - id: "tx_suspicious_pattern"
    name: "Suspicious Transaction Pattern Detection"
    description: "Identifies suspicious patterns in transaction sequences"
    type: "pattern_detection"
    severity: "high"
    config:
      time_window: "24h"
      group_by: ["account_id", "transaction_type"]
      patterns:
        - name: "structured_deposits"
          condition: "sum(amount) > 9000 AND count(*) >= 3"
          time_frame: "24h"
        - name: "rapid_withdrawals"
          condition: "count(*) > 5 AND sum(amount) > 5000"
          time_frame: "1h"
    metadata:
      regulatory_requirement: "SAR Filing"
      alert_threshold: "0.95"

  - id: "tx_completeness"
    name: "Transaction Data Completeness"
    description: "Ensures all required transaction fields are present"
    type: "completeness_check"
    severity: "high"
    config:
      required_fields:
        - field: "transaction_id"
          allow_nulls: false
        - field: "account_id"
          allow_nulls: false
        - field: "transaction_type"
          allow_nulls: false
        - field: "transaction_amount"
          allow_nulls: false
        - field: "transaction_timestamp"
          allow_nulls: false
      threshold: 0.999  # 99.9% completeness required

  - id: "tx_velocity"
    name: "Transaction Velocity Check"
    description: "Monitors transaction frequency and volume"
    type: "velocity_check"
    severity: "medium"
    config:
      dimensions:
        - name: "account_level"
          group_by: ["account_id"]
          thresholds:
            max_count_per_hour: 100
            max_amount_per_day: 50000.00
        - name: "customer_level"
          group_by: ["customer_id"]
          thresholds:
            max_count_per_day: 200
            max_amount_per_week: 100000.00

  - id: "tx_reference_integrity"
    name: "Transaction Reference Integrity"
    description: "Validates reference data integrity"
    type: "referential_integrity"
    severity: "high"
    config:
      references:
        - source_field: "account_id"
          target_table: "accounts"
          target_field: "account_id"
        - source_field: "customer_id"
          target_table: "customers"
          target_field: "customer_id"
        - source_field: "branch_id"
          target_table: "branches"
          target_field: "branch_id"
      cache_reference_data: true
      cache_ttl_minutes: 60

anomaly_detection:
  - id: "tx_amount_anomaly"
    name: "Transaction Amount Anomaly Detection"
    type: "statistical"
    config:
      method: "zscore"
      parameters:
        window_size: "30d"
        threshold: 3.0
      dimensions: ["account_type", "customer_segment"]

  - id: "tx_frequency_anomaly"
    name: "Transaction Frequency Anomaly"
    type: "ml_based"
    config:
      model_type: "isolation_forest"
      features:
        - "hourly_transaction_count"
        - "daily_transaction_volume"
        - "avg_transaction_amount"
      training_window: "90d"
      contamination: 0.01

alerts:
  - id: "critical_tx_alert"
    name: "Critical Transaction Alert"
    condition: "severity = 'critical'"
    channels:
      - type: "email"
        recipients: ["fraud-team@bank.com"]
      - type: "slack"
        channel: "#fraud-alerts"
      - type: "api"
        endpoint: "/api/v1/fraud-alerts"

metrics:
  - name: "transaction_quality_score"
    type: "composite"
    components:
      - rule_id: "tx_completeness"
        weight: 0.3
      - rule_id: "tx_reference_integrity"
        weight: 0.3
      - rule_id: "tx_amount_range"
        weight: 0.2
      - rule_id: "tx_suspicious_pattern"
        weight: 0.2
    threshold: 0.95
